var UploadImage=function(){function e(e,a,t){var n=new FormData,o=new XMLHttpRequest;n.append("file",document.querySelector("#"+t).files[e]),o.addEventListener("load",function(e){"success"==o.response.status?(a.querySelector(".text").innerHTML="<div><span>"+o.response.name+'</span><a style="cursor:pointer;color: #fff;" data-path="'+o.response.path+'" data-image="'+o.response.name+'" class="btn btn-info py-0 ml-1 text-white showImage">Visualizar <i class="fas fa-image" ></i></a><a style="cursor:pointer;color: #fff;" class="btn btn-danger py-0 ml-1 btn-delete-image text-white">Remover <i class="fas fa-trash-alt" ></i></a></div><input type="hidden" name="'+t+'" value="'+o.response.name+'">',a.classList.add("complete")):(a.querySelector(".text").innerHTML="Erro ao enviar: "+o.response.name,a.classList.add("error"))}),o.upload.addEventListener("progress",function(e){var t=e.loaded/e.total*100;a.querySelector(".fill").style.minWidth=t+"%"}),o.responseType="json",o.open("post",APP_URL+"/uploads"),o.setRequestHeader("x-csrf-token",CSRF_TOKEN),o.send(n)}return{init:function(){$(document).on("dragenter",".area-upload",function(){$(".area-upload .label-upload").addClass("highlight")}),$(document).on("dragleave drop",".area-upload",function(){$(".area-upload .label-upload").removeClass("highlight")}),$(document).on("change",".upload-file",function(){let a=$(this).attr("id");for(var t,n=this.files,o=0;o<n.length;o++){var s=(t=n[o],-1==["image/jpeg","image/jpeg","image/webp","image/png"].indexOf(t.type)?(Swal.fire({icon:"error",title:"Erro!",text:"O arquivo "+t.name+" não permitido"}),{error:"O arquivo "+t.name+" não permitido"}):t.size>2097152?(Swal.fire({icon:"error",title:"Erro!",text:t.name+" ultrapassou limite de 2MB"}),{error:t.name+" ultrapassou limite de 2MB"}):{success:"Enviando: "+t.name});$("."+a+".barra").remove();var i=document.createElement("div"),d=document.createElement("div"),r=document.createElement("div");i.appendChild(d),i.appendChild(r),i.classList.add("barra"),d.classList.add("fill"),r.classList.add("text"),null==s.error?(r.innerHTML=s.success,e(o,i,a)):(r.innerHTML=s.error,i.classList.add("error")),document.querySelector("."+a).appendChild(i)}}),$(document).on("click",".showImage",function(){let e=$(this).data("path"),a=$(this).data("image");$("body").append('<div class="modal fade" id="imagesModel"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5>'+a+'</h5><button type="button" class="close removeModal" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"></div></div></div></div>'),$("#imagesModel .modal-body").append('<img src="'+e+"/"+a+'" class="mx-auto d-block" style="max-width:100%;">'),$("#imagesModel").modal({shown:!0})}),$(document).on("click",".removeModal",function(){$("#imagesModel").modal({hide:!0}),$("#imagesModel").modal({hide:!0})&&$("#imagesModel img").remove()}),$(document).on("click",".btn-featured",function(){$('[name="featured[]"]').val("0"),$(this).parent().children().val("1"),$(".stars").removeClass("btn-warning"),$(".stars").addClass("btn-secondary"),$(this).removeClass("btn-secondary"),$(this).addClass("btn-warning")}),$(document).on("click",".btn-delete-image",function(){$(this).parent().parent().parent().remove()})}}}();jQuery(document).ready(function(){UploadImage.init()});
