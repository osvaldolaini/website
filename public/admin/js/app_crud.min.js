var App_crud=function(){let e=function(){return window.location.pathname.split("/")[1]};function o(e){var o="",a=!1;return $(e).find("select,input").each(function(){if($(this).prop("required")&&0==$(this).prop("disabled")&&!$(this).val()){var e=$(this).attr("name");a=!0;var r=$(this).attr("data-name");o+='<p class="text-danger"><i class="fas fa-exclamation-triangle"></i> '+r+" é um campo obrigatório</p>",$('[data-name="'+r+'"]').parent().children().addClass("has-error"),$("label#"+e+"-error").remove(),$('[name="'+e+'"]').parent().append('<label id="'+e+'-error" class="has-error" for="'+e+'" >Campo de preenchimento obrigat&oacute;rio.</label>')}}),{error:a,msg:o}}return{init:function(){$("#save").click(function(){let a=$(".save").serialize(),r=$(".save").data("id");if(r)var t=APP_URL+"/"+e()+"/"+r;else t=APP_URL+"/"+e();var n=o(".save");1==n.error?Swal.fire({icon:"error",title:"Erro!",html:n.msg}):Swal.fire({title:"Todos os dados estão corretos?",text:"Não será possível reverter esta ação!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",cancelButtonText:"Não",confirmButtonText:"Sim"}).then(e=>{!0===e.value&&$.ajax({url:t,method:"POST",data:a,success:function(e){console.log(e),e.success?Swal.fire({icon:"success",title:"Sucesso!",text:e.message}):(console.log(e),Swal.fire({icon:"error",title:"Erro!",text:e.message}))},error:function(e){console.log(e);var o="";$.each(e.responseJSON.errors,function(e,a){$("[name="+e+"]").addClass("has-error"),$("[name="+e+"]").parent().children().addClass("has-error"),$("[name="+e+"]").parent().append('<label id="'+e+'-error" class="error" for="'+e+'">O valor indicado já existe no banco de dados.</label>');var r=$("[name="+e+"]").data("name");o+='<p class="text-danger"><i class="fas fa-exclamation-triangle"></i> O valor do campo <strong>'+r+"</strong> já existe no banco de dados.</p>"}),Swal.fire({icon:"error",title:"Erro!",html:o})}})})}),$("#save_out").click(function(){let a=$(".save").serialize(),r=$(".save").data("id");if(r)var t=APP_URL+"/"+e()+"/"+r;else t=APP_URL+"/"+e();var n=o(".save");1==n.error?Swal.fire({icon:"error",title:"Erro!",html:n.msg}):Swal.fire({title:"Todos os dados estão corretos?",text:"Não será possível reverter esta ação!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",cancelButtonText:"Não",confirmButtonText:"Sim"}).then(e=>{!0===e.value&&$.ajax({url:t,method:"POST",data:a,success:function(e){e.success?(console.log(e),Swal.fire({icon:"success",title:"Sucesso!",text:e.message}).then(o=>{window.location.href=e.location})):(console.log(e),Swal.fire({icon:"error",title:"Erro!",text:e.message}))},error:function(e){console.log(e);var o="";$.each(e.responseJSON.errors,function(e,a){$("[name="+e+"]").addClass("has-error"),$("[name="+e+"]").parent().children().addClass("has-error"),$("[name="+e+"]").parent().append('<label id="'+e+'-error" class="error" for="'+e+'">O valor indicado já existe no banco de dados.</label>');var r=$("[name="+e+"]").data("name");o+='<p class="text-danger"><i class="fas fa-exclamation-triangle"></i> O valor do campo <strong>'+r+"</strong> já existe no banco de dados.</p>"}),Swal.fire({icon:"error",title:"Erro!",html:o})}})})}),$(document).on("click",".viewModel",function(){let o=$(this).attr("data-id");var a=APP_URL+"/"+e()+"/"+o;$.ajax({url:a,method:"GET",success:function(e){if(e.success){$("#modalView").modal("show"),$("#modalView .modal-title").html('<i class="fas fa-user"></i> '+e.data.title),$("#modalView .modal-body #body").html(""),$("#modalView .modal-body #body").append('<div class="col"><div class="row" id="itens"></div></div>');for(const o in e.data.body)"image"==o?$("#modalView .modal-body #body").append('<div class="col text-center"><img class="w-50" src="'+e.data.body[o]+'"></div>'):$("#modalView .modal-body #itens").append('<div class="col-lg-6" ><h4 ><strong>'+o+":</strong></h4><h5 >"+e.data.body[o]+"</h5></div>")}else Swal.fire({icon:"error",title:"Erro!",text:e.message})},error:function(e){console.log(e)}})}),$(document).on("click",".delete",function(){let o=$(this).attr("data-id");if(o)var a=APP_URL+"/"+e()+"/"+o;else Swal.fire({icon:"error",title:"Erro!",text:"Selecione um arquivo válido."});Swal.fire({title:"Tem certeza que deseja excluir este arquivo?",text:"Não será possível reverter esta ação!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",cancelButtonText:"Não",confirmButtonText:"Sim"}).then(e=>{!0===e.value&&$.ajax({url:a,method:"DELETE",data:{id:o},success:function(e){console.log(e),e.success?Swal.fire({icon:"success",title:"Sucesso!",text:e.message}).then(o=>{window.location.href=e.location}):Swal.fire({icon:"error",title:"Erro!",text:e.message})},error:function(e){console.log(e)}})})}),$(document).on("click",".delete-commit",function(){let o=$(this).attr("data-id");if(o)var a=APP_URL+"/"+e()+"/"+o;else Swal.fire({icon:"error",title:"Erro!",text:"Selecione um arquivo válido."});Swal.mixin({icon:"warning",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",cancelButtonText:"Não",confirmButtonText:"Sim",input:"text"}).queue([{title:"Tem certeza que deseja excluir este arquivo?",text:"Não será possível reverter esta ação!"}]).then(e=>{e.value&&(""!=e.value?$.ajax({url:a,method:"DELETE",data:{id:o,motive:e.value[0]},success:function(e){e.success?Swal.fire({icon:"success",title:"Sucesso!",text:e.message}).then(o=>{window.location.href=e.location}):Swal.fire({icon:"error",title:"Erro!",text:e.message})},error:function(e){console.log(e)}}):Swal.fire({icon:"error",title:"Erro!",text:"Por favor, escreva o motivo da exclusão."}))})}),$(document).on("click",".export",function(){let e=$("#wsearch").serialize();var o=$(this).data("export"),a=APP_URL+"/export/"+o+"?"+e;window.open(a,"_BLANK")}),$("#send").click(function(){let e=$(".save").serialize(),a=$(".save").data("id");var r=APP_URL+"/send-response/"+a,t=o(".save");1==t.error?Swal.fire({icon:"error",title:"Erro!",html:t.msg}):Swal.fire({title:"Tem certeza que deseja enviar o email?",text:"Não será possível reverter esta ação!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#dc3545",cancelButtonText:"Não",confirmButtonText:"Sim"}).then(o=>{!0===o.value&&$.ajax({url:r,method:"POST",data:e,success:function(e){console.log(e),e.success?Swal.fire({icon:"success",title:"Sucesso!",text:e.message}):(console.log(e),Swal.fire({icon:"error",title:"Erro!",text:e.message}))},error:function(e){console.log(e);var o="";$.each(e.responseJSON.errors,function(e,a){$("[name="+e+"]").addClass("has-error"),$("[name="+e+"]").parent().children().addClass("has-error"),$("[name="+e+"]").parent().append('<label id="'+e+'-error" class="error" for="'+e+'">O valor indicado já existe no banco de dados.</label>');var r=$("[name="+e+"]").data("name");o+='<p class="text-danger"><i class="fas fa-exclamation-triangle"></i> O valor do campo <strong>'+r+"</strong> já existe no banco de dados.</p>"}),Swal.fire({icon:"error",title:"Erro!",html:o})}})})})}}}();jQuery(document).ready(function(){App_crud.init()});
